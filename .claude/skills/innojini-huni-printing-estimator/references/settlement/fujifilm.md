# 후지필름 정산 가이드

## 파일 구조

### 시트 목록 (1개)

| 시트명 | 행수 | 용도 |
|-------|-----|-----|
| **Sheet** | ~57 | 전체 정산 데이터 |

---

## 시트 상세

### Sheet (외주사 데이터)

**주요 컬럼:**
| 컬럼 | 설명 | 예시 |
|-----|-----|-----|
| 거래처주문번호 | 매칭 Key | B2510241538223 |
| 주문자명 | 거래처명 | 롯데몰 은평점 |
| 품목 명 | 품목 | 포토북 |
| 주문제목 | 상세 상품명 | 8x10_70P_PDF_SOFT |
| 제작수량 | 정산 수량 | 1 |
| 생산단가 | 단가 | ⚠️ 비어있음 |
| 금액 | 금액 | ⚠️ 비어있음 |
| 주문상태 | 상태 | 출고 완료 |

**주문상태 분포:**
```
출고 완료    43건 ← 정산 대상
제작 대기    14건 ← 다음 정산
```

**품목별 분포:**
```
포토북              29건
아크릴키링           7건
반칼팬시스티커        6건
포토카드             4건
엽서북               3건
핀버튼               3건
레더스트랩키링        3건
```

---

## MES 내부 데이터

### 파일: 00__MES.xlsx

**주문통합 상품별리스트 시트:**
| 컬럼 | 설명 | 예시 |
|-----|-----|-----|
| 주문번호 | 매칭 Key | M2511251913582 |
| 거래처명 | 외주사 식별 | 스튜디오thd |
| ERP품명 | 품목명 | 아크릴키링(하트) |
| 수량 | 수량 | 1 |
| 주문상태 | 상태 | 구매확정 |

---

## 매칭 로직

### 매칭 흐름
```
후지필름.거래처주문번호 (예: M2511032226540S1)
        ↓
정규화 (S1 제거) → M2511032226540
        ↓
MES.주문번호 (예: M2511032226540)
        ↓
매칭 성공!
```

### 주문번호 정규화
```python
import re

def normalize_order_id(order_id):
    """S1, S2 등 접미사 제거"""
    if pd.isna(order_id):
        return None
    return re.sub(r'S\d+$', '', str(order_id))
```

---

## ⚠️ 금액 처리 (특이사항)

### 문제점
후지필름 파일의 금액 컬럼이 **모두 비어있음**:
- 생산단가: 0건 (모두 NaN)
- 금액: 0건 (모두 NaN)
- 배송비: 0건 (모두 NaN)

### 해결: 가격표 DB 연동
```python
FUJI_PRICE_TABLE = {
    # 포토북
    "8x10_70P_PDF_SOFT": 72000,
    "8x10_40P_PDF_HARD": 58000,
    "6x8_20P_PDF_HARD": 38000,
    
    # 아크릴키링
    "아크릴키링(원형)": 8000,
    "아크릴키링(타원형)": 8000,
    
    # 기타
    "엽서북100x150": 25000,
    "핀버튼": 5000,
}

def calculate_amount(product_name, qty):
    unit_price = FUJI_PRICE_TABLE.get(product_name, 0)
    return unit_price * qty
```

---

## 분석 결과 예시

```
📊 매칭 결과
├─ 총 건수 (후지):     57건
├─ 유니크 주문 (후지):  29개
├─ 유니크 주문 (MES):   30개
├─ 매칭 성공:          27건
├─ 후지에만 존재:       2건
└─ MES에만 존재:        3건

📦 품목별 수량
├─ 포토북:            96건
├─ 레더스트랩키링:     20건
├─ 반칼팬시스티커:     12건
└─ 아크릴키링:         7건

⚠️ 금액: 가격표 연동 필요
```

---

## 불일치 상세

### 후지에만 존재 (2건)
| 주문번호 | 고객명 | 사유 |
|---------|-------|-----|
| B2510241538223 | 롯데몰 은평점 | 10월 주문 |
| B2510251223363 | 준포토(춘천) | 10월 주문 |

### MES에만 존재 (3건)
| 주문번호 | 고객명 | 사유 |
|---------|-------|-----|
| M2511211355322 | 조민희 | 최신 주문 |
| B2511201920013 | 장태양 | 최신 주문 |
| M2511032258328 | 이지아 | 최신 주문 |
