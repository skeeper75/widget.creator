# 조판 계산 및 자투리 배치 레퍼런스

## 개요

완성물 크기를 용지에 최적 배치하고, 자투리 영역까지 활용하는 방법을 정리합니다.

---

## 1. 핵심 원칙

```
⚠️ 완성물 크기는 절대 불변!
⚠️ 자투리도 동일한 완성물 크기로 앉힌다!
```

### 잘못된 이해
"자투리 = 사용할 수 없는 여백"

### 올바른 이해
"자투리 = 동일한 완성물을 추가로 배치할 수 있는 공간"

---

## 2. 용지 규격

| 규격 | 크기 (mm) | 용도 |
|-----|----------|------|
| 국전 | 636 × 939 | 국내 표준 |
| 46전 | 788 × 1091 | 국제 표준 |
| 46전횡 | 1091 × 788 | 46전 가로 방향 |
| 46반 | 545 × 788 | 46전의 절반 |
| 국반 | 468 × 636 | 국전의 절반 |
| A1 | 594 × 841 | ISO A1 |
| A2 | 420 × 594 | ISO A2 |

---

## 3. 조판 계산 공식

### 기본 계산
```python
# 인쇄 크기 = 완성물 + 도련
print_w = finished_w + (bleed × 2)
print_h = finished_h + (bleed × 2)

# 가로 배치
cols = floor(paper_w / print_w)
rows = floor(paper_h / print_h)
ups_horizontal = cols × rows

# 세로 배치 (90° 회전)
cols = floor(paper_w / print_h)
rows = floor(paper_h / print_w)
ups_vertical = cols × rows

# 더 효율적인 방향 선택
ups = max(ups_horizontal, ups_vertical)
```

### 효율 계산
```python
efficiency = (ups × print_w × print_h) / (paper_w × paper_h) × 100
```

---

## 4. 자투리 배치

### 개념 다이어그램

```
┌───────────────────────────────────────────────┐
│               46전 (788×1091mm)               │
│                                               │
│  ┌────┬────┬────┬────┬────┐ ┃ ┌────┐         │
│  │  1 │  2 │  3 │  4 │  5 │ ┃ │ 26 │ 우측    │
│  ├────┼────┼────┼────┼────┤ ┃ ├────┤ 자투리  │
│  │  6 │  7 │  8 │  9 │ 10 │ ┃ │ 27 │ (90°)   │
│  ├────┼────┼────┼────┼────┤ ┃ ├────┤         │
│  │ 11 │ 12 │ 13 │ 14 │ 15 │ ┃ │ 28 │         │
│  ├────┼────┼────┼────┼────┤ ┃ └────┘         │
│  │ 16 │ 17 │ 18 │ 19 │ 20 │ ┃               │
│  ├────┼────┼────┼────┼────┤ ┃               │
│  │ 21 │ 22 │ 23 │ 24 │ 25 │ ┃               │
│  └────┴────┴────┴────┴────┘ ┃               │
│        정규 배열 (5×5=25UP)  ┃    +3UP       │
│                                               │
└───────────────────────────────────────────────┘
```

### 자투리 배치 로직

```python
def calc_waste_placement(paper_w, paper_h, print_w, print_h, main_cols, main_rows, orientation):
    """자투리 영역에 추가 배치 계산"""
    
    # 정규 배열 후 남는 공간
    if orientation == "가로":
        used_w = main_cols * print_w
        used_h = main_rows * print_h
    else:
        used_w = main_cols * print_h
        used_h = main_rows * print_w
    
    remain_w = paper_w - used_w
    remain_h = paper_h - used_h
    
    waste_ups = 0
    
    # 우측 자투리 (90° 회전 배치)
    if orientation == "가로" and remain_w >= print_h:
        waste_cols = floor(remain_w / print_h)
        waste_rows = floor(paper_h / print_w)
        waste_ups += waste_cols * waste_rows
    
    # 하단 자투리 (90° 회전 배치)
    if orientation == "가로" and remain_h >= print_w:
        waste_cols = floor(paper_w / print_h)
        waste_rows = floor(remain_h / print_w)
        waste_ups += waste_cols * waste_rows
    
    return waste_ups
```

---

## 5. 자투리 배치 결과 예시

### A5 (148×210mm) 기준

| 용지 | 정규 | 정규UP | 우측 | 하단 | 합계 | 효율 |
|-----|------|--------|------|------|------|------|
| 46전 | 5×5 | 25UP | - | - | 25UP | 96.7% |
| 46전횡 | 5×5 | 25UP | - | - | 25UP | 96.7% |
| 국전 | 4×4 | 16UP | - | - | 16UP | 89.1% |
| **A1** | 2×5 | 10UP | **+3** | - | **★13UP** | 86.6% |
| 46반 | 2×5 | 10UP | - | - | 10UP | 77.5% |
| 국반 | 2×4 | 8UP | - | - | 8UP | 89.4% |
| **A2** | 2×2 | 4UP | - | **+1** | **★5UP** | 66.7% |

### A4 (210×297mm) 기준

| 용지 | 정규 | 정규UP | 우측 | 하단 | 합계 | 효율 |
|-----|------|--------|------|------|------|------|
| 46전 | 2×5 | 10UP | - | - | 10UP | 76.1% |
| 국전 | 2×4 | 8UP | - | - | 8UP | 87.7% |
| **A1** | 2×2 | 4UP | - | **+1** | **★5UP** | 65.5% |

---

## 6. 자투리 처리 방식

| 방식 | 설명 | 적합한 경우 |
|-----|------|-----------|
| **무시** | 기본 UP수만 사용 | 단순 작업, 빠른 납기 |
| **여분 확보** | 손실 대비 예비 수량 | 후가공 많은 작업 |
| **추가 수량** | UP수 증가로 더 많이 생산 | 수량 극대화 |
| **합대** | 다른 버전/품목 배치 | 소량 다품종 |

### 합대 예시
```
┌────────────────────────────────────┐
│  ┌────┬────┬────┬────┬────┐       │
│  │ A  │ A  │ A  │ A  │ A  │       │
│  ├────┼────┼────┼────┼────┤       │
│  │ A  │ A  │ A  │ A  │ A  │       │
│  ├────┼────┼────┼────┴────┴────┐  │
│  │ A  │ A  │ A  │              │  │
│  └────┴────┴────┤  B × 3       │  │
│                 │  (다른 버전)  │  │
│                 └──────────────┘  │
└────────────────────────────────────┘
```

---

## 7. CLI 사용법

```bash
# 조판 계산 (자투리 포함)
python3 scripts/estimate_v3.py imposition --width 148 --height 210

# 자투리 제외
python3 scripts/estimate_v3.py imposition --width 148 --height 210 --no-waste

# 특정 용지만 계산
python3 scripts/estimate_v3.py imposition --width 148 --height 210 --format 46전

# JSON 출력
python3 scripts/estimate_v3.py imposition --width 148 --height 210 --json
```

### 출력 예시

```
📐 조판 계산 결과

완성물: 148 × 210 mm
인쇄 크기: 154 × 216 mm (도련 3mm)

규격       크기           정규      자투리    합계     효율
──────────────────────────────────────────────────────
46전      788×1091     5×5=25UP     -       25UP   🟢 96.7%
A1        594×841      2×5=10UP    +3      ★13UP  🟢 86.6%
국반       468×636      2×4=8UP      -        8UP   🟢 89.4%
A2        420×594      2×2=4UP     +1       ★5UP  🟡 66.7%
```

---

## 8. 주의사항

1. **자투리 배치 시 90° 회전**: 자투리 영역에는 정규 배열과 다른 방향으로 배치
2. **CTP 분리**: 자투리가 정규 배열과 다른 방향이면 별도 CTP 필요할 수 있음
3. **후가공 고려**: 자투리 위치에 따라 후가공 동선이 달라질 수 있음
4. **여분율 계산**: 자투리를 여분으로 사용할 경우 별도 계산 필요

---

*Last Updated: 2025-12-04*
